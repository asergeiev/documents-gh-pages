<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/documents/blog/rss.xml" title="CompreFace RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documents/blog/atom.xml" title="CompreFace Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="CompreFace" href="/documents/opensearch.xml"><title data-react-helmet="true">Architecture and Scalability | CompreFace</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://asergeiev.github.io/documents/docs/architecture-and-scalability"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Architecture and Scalability | CompreFace"><meta data-react-helmet="true" name="description" content="CompreFace is delivered as a docker-compose file by default, so you can"><meta data-react-helmet="true" property="og:description" content="CompreFace is delivered as a docker-compose file by default, so you can"><link data-react-helmet="true" rel="shortcut icon" href="/documents/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://asergeiev.github.io/documents/docs/architecture-and-scalability"><link data-react-helmet="true" rel="alternate" href="https://asergeiev.github.io/documents/docs/architecture-and-scalability" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://asergeiev.github.io/documents/docs/architecture-and-scalability" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://HXJSB0I3EO-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/documents/assets/css/styles.bd0382db.css">
<link rel="preload" href="/documents-gh-pages/assets/js/runtime~main.3ab37260.js" as="script">
<link rel="preload" href="/documents-gh-pages/assets/js/main.de9e6c77.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documents/"><div class="navbar__logo"><img src="/documents/img/logo.png" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/documents/img/logo.png" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">CompreFace</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/documents/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/how-to-use">How to use CompreFace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/face-services-and-plugins">Face Services and Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/rest-api-description">Rest API Description</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/face-recognition-similarity-threshold">Face Recognition Similarity Threshold</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/documents/docs/architecture-and-scalability">Architecture and Scalability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/custom-builds">Custom Builds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/face-data-migration">Face Data Migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/user-roles-system">User Roles System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/mask-detection-plugin">Face Mask Detection Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/gathering-anonymous-statistics">Gathering Anonymous Statistics</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Architecture and Scalability</h1></header><p>CompreFace is delivered as a docker-compose file by default, so you can
easily start it with one command. However, CompreFace could be scaled up
to distribute computations on different servers and achieve high
availability. This section describes the architecture of CompreFace,
each of its components, and suggestions on how to scale the system.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="compreface-architecture-diagram">CompreFace architecture diagram<a aria-hidden="true" class="hash-link" href="#compreface-architecture-diagram" title="Direct link to heading">â€‹</a></h2><p>CompreFace architecture diagram</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="balancer--ui">Balancer + UI<a aria-hidden="true" class="hash-link" href="#balancer--ui" title="Direct link to heading">â€‹</a></h2><p>Container name in the docker-compose file: compreface-fe</p><p>This container runs Nginx that serves CompreFace UI.</p><p>In the default config, it&#x27;s also used as the main gateway - Nginx
proxies user requests to admin and API servers.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="admin-server">Admin server<a aria-hidden="true" class="hash-link" href="#admin-server" title="Direct link to heading">â€‹</a></h2><p>Container name in the docker-compose file: compreface-admin</p><p>Admin server is a Spring Boot application, and it&#x27;s responsible for all
operations that are done on UI. Admin server connects to PostgreSQL
database to store the data.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="api-servers">API servers<a aria-hidden="true" class="hash-link" href="#api-servers" title="Direct link to heading">â€‹</a></h2><p>Container name in the docker-compose file: compreface-API</p><p>API servers handle all user API calls: face recognition, face detection,
and face verification.</p><p>It provides API key validation, proxies images to Embedding servers, and
classifies the face. For face classification, we use the ND4J library.</p><p>By default, the number of API servers in the config is 1, but for production
environments to increase possible bandwidth and achieve high
availability, there should be at least two such servers, and they should
be on different machines. In addition, the data synchronization is
implemented via PostgreSQL notifications, so if, for example, you add a
new face to a collection, all other servers know about it and can
recognize this new face.</p><p>Classification is not a very heavy operation as embedding calculation
and doesn&#x27;t require GPU in most cases. API server connects to PostgreSQL
database to store the data.</p><p>There is a PYTHON_URL environment variable that tells this container where
to send requests to compreface-core containers.
Default value: http://compreface-core:3000.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="embedding-servers">Embedding Servers<a aria-hidden="true" class="hash-link" href="#embedding-servers" title="Direct link to heading">â€‹</a></h2><p>Container name in the docker-compose file: compreface-core</p><p>The embedding server is responsible for running neural networks. It
calculates embeddings from faces and makes all plugin recognitions like
age and gender detection. These servers are stateless, don&#x27;t have a
connection to a database, and don&#x27;t require any synchronization between
them.</p><p>By default, the number of API servers in the config is 1, but for production
environments to increase possible bandwidth and achieve high
availability, there should be at least two such servers, and they should
be on different machines.</p><p>Running neural networks is a complicated operation. Therefore, the total
performance of the system highly depends on these nodes. That is why we
recommend using highly performant nodes to run Embedding Servers,
ideally with GPU support. To learn more about how to run CompreFace with
GPU, see custom <a href="/documents/docs/custom-builds">builds documentation</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="postgresql">PostgreSQL<a aria-hidden="true" class="hash-link" href="#postgresql" title="Direct link to heading">â€‹</a></h2><p>Default docker-compose configuration includes postgreSQL database.</p><p>If you want CompreFace to connect to your database, you need to provide
such environment variables for compreface-admin and compreface-API
containers: <!-- -->*<!-- --> POSTGRES_PASSWORD <!-- -->*<!-- --> POSTGRES_URL <!-- -->*<!-- --> POSTGRES_USER</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/Architecture-and-scalability.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/documents/docs/configuration"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Configuration</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/documents/docs/custom-builds"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Custom Builds<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#compreface-architecture-diagram" class="table-of-contents__link toc-highlight">CompreFace architecture diagram</a></li><li><a href="#balancer--ui" class="table-of-contents__link toc-highlight">Balancer + UI</a></li><li><a href="#admin-server" class="table-of-contents__link toc-highlight">Admin server</a></li><li><a href="#api-servers" class="table-of-contents__link toc-highlight">API servers</a></li><li><a href="#embedding-servers" class="table-of-contents__link toc-highlight">Embedding Servers</a></li><li><a href="#postgresql" class="table-of-contents__link toc-highlight">PostgreSQL</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/documents/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 EDY, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/documents/assets/js/runtime~main.3ab37260.js"></script>
<script src="/documents/assets/js/main.de9e6c77.js"></script>
</body>
</html>