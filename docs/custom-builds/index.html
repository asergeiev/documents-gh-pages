<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/documents/blog/rss.xml" title="CompreFace RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documents/blog/atom.xml" title="CompreFace Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="CompreFace" href="/documents/opensearch.xml"><title data-react-helmet="true">Custom Builds | CompreFace</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://asergeiev.github.io/documents/docs/custom-builds"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Custom Builds | CompreFace"><meta data-react-helmet="true" name="description" content="There is always a trade-off between the face recognition accuracy, the"><meta data-react-helmet="true" property="og:description" content="There is always a trade-off between the face recognition accuracy, the"><link data-react-helmet="true" rel="shortcut icon" href="/documents/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://asergeiev.github.io/documents/docs/custom-builds"><link data-react-helmet="true" rel="alternate" href="https://asergeiev.github.io/documents/docs/custom-builds" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://asergeiev.github.io/documents/docs/custom-builds" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://HXJSB0I3EO-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/documents/assets/css/styles.bd0382db.css">
<link rel="preload" href="/documents/assets/js/runtime~main.3ab37260.js" as="script">
<link rel="preload" href="/documents/assets/js/main.de9e6c77.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documents/"><div class="navbar__logo"><img src="/documents/img/logo.png" alt="My Site Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/documents/img/logo.png" alt="My Site Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">CompreFace</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/documents/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_NKBi"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/how-to-use">How to use CompreFace</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/face-services-and-plugins">Face Services and Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/rest-api-description">Rest API Description</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/face-recognition-similarity-threshold">Face Recognition Similarity Threshold</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/architecture-and-scalability">Architecture and Scalability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/documents/docs/custom-builds">Custom Builds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/face-data-migration">Face Data Migration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/user-roles-system">User Roles System</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/mask-detection-plugin">Face Mask Detection Plugin</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documents/docs/gathering-anonymous-statistics">Gathering Anonymous Statistics</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Custom Builds</h1></header><p>There is always a trade-off between the face recognition accuracy, the
system&#x27;s max throughput, and even hardware support.</p><p>By default, the CompreFace release contains configuration that could be
run on the widest variety of hardware.</p><p>The downside of this build is that it&#x27;s not optimized for the latest
generations of CPU and doesn&#x27;t support GPU.</p><p>With custom-builds, we aim to cover as many cases as we can. They are
not tested as well as the default build, and we encourage the community
to report any bugs related to these builds.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="list-of-custom-builds">List of custom-builds<a aria-hidden="true" class="hash-link" href="#list-of-custom-builds" title="Direct link to heading">â€‹</a></h2><p>You can find the list of custom builds</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="contribution">Contribution<a aria-hidden="true" class="hash-link" href="#contribution" title="Direct link to heading">â€‹</a></h2><p>We also encourage the community to share their builds; we will add them
to our list with notice that this is a community build.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-choose-a-build">How to choose a build<a aria-hidden="true" class="hash-link" href="#how-to-choose-a-build" title="Direct link to heading">â€‹</a></h2><p>Different builds are fit for different purposes - some of them have
higher accuracy, but the performance on CPU is low; others are optimized
for low-performance hardware and have acceptable accuracy. Of course,
you have to make your own choice in this trade-off. But generally, you
can follow these rules:</p><ul><li>If you want to run real-time face recognition, we recommend choosing
builds with GPU support.</li><li>If you need to run face recognition on old or low-performance
systems, we recommend using builds with models initially created for
mobile</li><li>Do not take the most accurate model blindly. The accuracy does not
vary significantly between models, but the required hardware
resources could differ dramatically</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-run-custom-builds">How to run custom-builds<a aria-hidden="true" class="hash-link" href="#how-to-run-custom-builds" title="Direct link to heading">â€‹</a></h2><p>Running custom-build is very similar to running the default build - all
you need to do is open the corresponding folder and run
<code>docker-compose up -d</code>.</p><p>Things to consider:</p><ul><li>If you run CompreFace from the custom-build
folder, it creates a new docker volume so that you won&#x27;t see your saved
information. To run custom-build with your previously saved information,
you need to copy files from custom-build to folder with the original
build (and replace the original files) </li><li>In most cases, face recognition
models are not interchangeable; this means that all you saved examples
from the old build won&#x27;t work on new builds. See <a href="/documents/docs/face-data-migration">migrations
documentation</a> to know what is the options. </li><li>Do not run two instances of CompreFace simultaneously without changing the
port. To change the port, go to the <code>docker-compose</code> file and change the
post for the <code>compreface-fe</code> container.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="how-to-build-your-own-custom-build">How to build your own custom-build<a aria-hidden="true" class="hash-link" href="#how-to-build-your-own-custom-build" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="custom-models">Custom models<a aria-hidden="true" class="hash-link" href="#custom-models" title="Direct link to heading">â€‹</a></h3><p>CompreFace supports two face recognition libraries - FaceNet and
InsightFace. It means CompreFace can run any model that can run these
libraries. So all you need to do is 1. Upload your model to Google Drive
and add it to one of the following files into the <code>Calculator</code> class: -
/embedding-calculator/src/services/facescan/plugins/facenet/facenet.py -
/embedding-calculator/src/services/facescan/plugins/insightface/insightface.py
2. Take the <code>docker-compose</code> file from <code>/dev</code> folder as a template 3.
Specify new model names in build arguments. For more information, look
at <a href="#run-service">this documentation</a>. E.g. here is a part of the
<code>docker-compose</code> file for building with a custom model with GPU support:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">compreface-core:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  image: ${registry}compreface-core:${CORE_VERSION}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  container_name: &quot;compreface-core&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - &quot;3300:3000&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  runtime: nvidia</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  build:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    context: ../embedding-calculator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    args:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - FACE_DETECTION_PLUGIN=insightface.FaceDetector@retinaface_r50_v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - CALCULATION_PLUGIN=insightface.Calculator@arcface_r100_v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - EXTRA_PLUGINS=insightface.LandmarksDetector,insightface.GenderDetector,insightface.AgeDetector,insightface.facemask.MaskDetector</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - BASE_IMAGE=compreface-core-base:base-cuda100-py37</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - GPU_IDX=0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  environment:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - ML_PORT=3000</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/Custom-builds.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/documents/docs/architecture-and-scalability"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Architecture and Scalability</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/documents/docs/face-data-migration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Face Data Migration<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#list-of-custom-builds" class="table-of-contents__link toc-highlight">List of custom-builds</a></li><li><a href="#contribution" class="table-of-contents__link toc-highlight">Contribution</a></li><li><a href="#how-to-choose-a-build" class="table-of-contents__link toc-highlight">How to choose a build</a></li><li><a href="#how-to-run-custom-builds" class="table-of-contents__link toc-highlight">How to run custom-builds</a></li><li><a href="#how-to-build-your-own-custom-build" class="table-of-contents__link toc-highlight">How to build your own custom-build</a><ul><li><a href="#custom-models" class="table-of-contents__link toc-highlight">Custom models</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/documents/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 EDY, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/documents/assets/js/runtime~main.3ab37260.js"></script>
<script src="/documents/assets/js/main.de9e6c77.js"></script>
</body>
</html>